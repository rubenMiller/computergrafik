// Credits to: https://processing.org/examples/smokeparticlesystem.html

// A simple Particle class, renders the particle as an image

using System;
using OpenTK.Mathematics;
using Zenseless.OpenTK;

public Particle
{
    Vector2 loc;
    Vector2 vel;
    Vector2 acc;
    float lifespan;
    Texture2D img;

    public Particle(Vector2 l, Texture2D img_)
    {
        acc = new Vector2(0, 0);
        var r = new Random();
        float vx = r.NextGaussian() * 0.3;
        float vy = r.NextGaussian() * 0.3 - 1.0;
        vel = new Vector2(vx, vy);
        loc = l;
        lifespan = 100.0;
        img = img_;
    }

    void run()
    {
        update();
        render();
    }

    // Method to apply a force vector to the Particle object
    // Note we are ignoring "mass" here
    void applyForce(Vector2 f)
    {
        acc.Add(f);
    }

    // Method to update position
    void update()
    {
        vel.add(acc);
        loc.add(vel);
        lifespan -= 2.5;
        acc.mult(0); // clear Acceleration
    }

    // Method to display
    void render()
    {
        imageMode(CENTER);
        tint(255, lifespan);
        image(img, loc.x, loc.y);
        // Drawing a circle instead
        // fill(255,lifespan);
        // noStroke();
        // ellipse(loc.x,loc.y,img.width,img.height);
    }

    // Is the particle still useful?
    boolean isDead()
    {
        if (lifespan <= 0.0)
        {
            return true;
        }
        else
        {
            return false;
        }
    }
}